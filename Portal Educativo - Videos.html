<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Educativo - Admin & Visualizaci√≥n</title>
    <style>
        :root {
            --color-primary: #2a7f9d;
            --color-primary-hover: #206680;
            --color-bg: #f5f5f5;
            --color-card: #ffffff;
            --color-text: #1a1a1a;
            --color-border: #e0e0e0;
            --color-success: #4caf50;
            --color-error: #ff6b6b;
            --color-warning: #ffa500;
            --space-16: 16px;
            --space-24: 24px;
            --radius-base: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
        }

        .header {
            background: linear-gradient(135deg, var(--color-primary), #1f6380);
            color: white;
            padding: 20px var(--space-16);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
        }

        .mode-selector {
            display: flex;
            gap: 8px;
        }

        .mode-btn {
            padding: 8px 16px;
            border: 2px solid white;
            background: transparent;
            color: white;
            cursor: pointer;
            border-radius: var(--radius-base);
            font-weight: 600;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: white;
            color: var(--color-primary);
        }

        .mode-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-24);
        }

        /* MODO ADMIN */
        .admin-panel {
            display: none;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-24);
            margin-bottom: var(--space-24);
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-group label {
            font-weight: 600;
            font-size: 14px;
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            padding: 10px;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            font-family: inherit;
            font-size: 14px;
        }

        .input-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius-base);
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-danger {
            background: var(--color-error);
            color: white;
        }

        .btn-danger:hover {
            background: #e55555;
        }

        .btn-success {
            background: var(--color-success);
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        .admin-tree {
            background: var(--color-card);
            border-radius: var(--radius-base);
            padding: var(--space-16);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .tree-item {
            padding: 12px;
            margin: 8px 0;
            background: var(--color-bg);
            border-left: 4px solid var(--color-primary);
            border-radius: var(--radius-base);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }

        .tree-item.level-0 {
            border-left-color: var(--color-primary);
            font-weight: 700;
            background: rgba(42, 127, 157, 0.08);
        }

        .tree-item.level-1 {
            border-left-color: #2a9d7f;
            font-weight: 600;
            margin-left: 20px;
        }

        .tree-item.level-2 {
            border-left-color: #9d7f2a;
            margin-left: 40px;
        }

        .tree-item.level-3 {
            border-left-color: var(--color-warning);
            margin-left: 60px;
            font-size: 14px;
        }

        .tree-item-actions {
            display: flex;
            gap: 4px;
        }

        .tree-item-actions button {
            padding: 4px 8px;
            font-size: 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: rgba(0,0,0,0.1);
            color: var(--color-text);
            transition: all 0.2s;
        }

        .tree-item-actions button:hover {
            background: rgba(0,0,0,0.2);
        }

        .export-import {
            display: flex;
            gap: 8px;
            margin-top: var(--space-16);
            flex-wrap: wrap;
        }

        /* MODO VISUALIZACI√ìN */
        .portal-view {
            display: none;
        }

        .portal-view.active {
            display: block;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: var(--space-24);
            font-size: 14px;
            flex-wrap: wrap;
        }

        .breadcrumb button {
            background: none;
            border: none;
            color: var(--color-primary);
            cursor: pointer;
            text-decoration: underline;
            font-family: inherit;
        }

        .breadcrumb button:hover {
            color: var(--color-primary-hover);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: var(--space-24);
            margin-bottom: var(--space-24);
        }

        .card {
            background: var(--color-card);
            border-radius: var(--radius-base);
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid var(--color-border);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .card-thumbnail {
            width: 100%;
            aspect-ratio: 16/9;
            background: linear-gradient(135deg, #e8f4f8, #d4e8f0);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }

        .card-content {
            padding: var(--space-16);
        }

        .card-title {
            font-weight: 600;
            font-size: 14px;
            line-height: 1.4;
        }

        .card-subtitle {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .message {
            padding: 12px 16px;
            border-radius: var(--radius-base);
            margin-bottom: 16px;
            font-weight: 500;
        }

        .message.success {
            background: rgba(76, 175, 80, 0.1);
            color: var(--color-success);
            border: 1px solid var(--color-success);
        }

        .message.error {
            background: rgba(255, 107, 107, 0.1);
            color: var(--color-error);
            border: 1px solid var(--color-error);
        }

        /* LOGIN STYLES */
        .login-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .login-overlay.active {
            display: flex;
        }

        .login-box {
            background: var(--color-card);
            padding: 40px;
            border-radius: var(--radius-base);
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center;
        }

        .login-box h2 {
            margin-bottom: 24px;
            color: var(--color-primary);
        }

        .login-box .input-group {
            margin-bottom: 16px;
            text-align: left;
        }

        .login-box input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            font-size: 14px;
        }

        .login-box .btn {
            width: 100%;
            margin-top: 8px;
        }

        .change-credentials-btn {
            position: absolute;
            top: 20px;
            right: 24px;
            padding: 6px 12px;
            background: #f0f0f0;
            border: none;
            border-radius: var(--radius-base);
            cursor: pointer;
            font-size: 12px;
            color: var(--color-text);
        }

        .change-credentials-btn:hover {
            background: #e0e0e0;
        }

        @media (max-width: 768px) {
            .admin-controls {
                grid-template-columns: 1fr;
            }

            .grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }

            .mode-selector {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìö Portal Educativo</h1>
        <div class="mode-selector">
            <button class="mode-btn active" onclick="switchMode('admin')">‚öôÔ∏è Admin</button>
            <button class="mode-btn" onclick="switchMode('view')">üëÅÔ∏è Ver Portal</button>
            <button class="change-credentials-btn" id="changeCredsBtn" style="display:none;" onclick="showChangeCredentialsModal()">üîê Cambiar Credenciales</button>
        </div>
    </div>

    <div class="container">
        <!-- MODO ADMIN -->
        <div class="admin-panel active" id="adminPanel">
            <div id="adminMessage"></div>

            <div class="admin-controls">
                <div style="grid-column: 1/-1;">
                    <h2>Agregar Elemento</h2>
                </div>

                <div class="input-group">
                    <label>Tipo de Elemento</label>
                    <select id="elementType" onchange="updateAdminForm()">
                        <option value="level">Nivel (ej: Ingl√©s 3 a√±os)</option>
                        <option value="area">√Årea (ej: Saludos)</option>
                        <option value="video">Video</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Nombre</label>
                    <input type="text" id="elementName" placeholder="Ej: Ingl√©s 3 a√±os">
                </div>

                <div id="thumbnailGroup" class="input-group" style="display:none;">
                    <label>Emoji para Miniatura</label>
                    <input type="text" id="thumbnail" placeholder="üéµ">
                </div>

                <div id="driveIdGroup" class="input-group" style="display:none;">
                    <label>ID de Google Drive</label>
                    <input type="text" id="driveId" placeholder="Pega aqu√≠ el ID del video">
                </div>

                <div id="videoTitleGroup" class="input-group" style="display:none;">
                    <label>T√≠tulo del Video</label>
                    <input type="text" id="videoTitle" placeholder="Ej: Colors Song">
                </div>

                <div class="input-group">
                    <label>Padre (D√≥nde agregarlo)</label>
                    <select id="parentSelect">
                        <option value="">Portal Principal</option>
                    </select>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="addElement()">‚úö Agregar</button>
                <button class="btn btn-secondary" onclick="clearAdminForm()">Limpiar</button>
            </div>

            <hr style="margin: 24px 0; border: none; border-top: 1px solid var(--color-border);">

            <h2 style="margin-bottom: 16px;">Estructura Actual</h2>
            <div class="admin-tree" id="adminTree"></div>

            <div class="export-import">
                <button class="btn btn-secondary" onclick="exportData()">‚¨áÔ∏è Exportar Datos</button>
                <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">‚¨ÜÔ∏è Importar Datos</button>
                <input type="file" id="importFile" style="display:none;" onchange="importData(event)">
                <button class="btn btn-secondary" onclick="saveToGitHub()">üíæ Guardar a GitHub</button>
                <button class="btn btn-danger" onclick="resetData()">üóëÔ∏è Borrar Todo</button>
            </div>
        </div>

        <!-- MODO VISUALIZACI√ìN -->
        <div class="portal-view" id="portalView">
            <div class="breadcrumb" id="breadcrumb"></div>
            <div id="portalContent"></div>
        </div>
    </div>

    <!-- LOGIN OVERLAY -->
    <div class="login-overlay active" id="loginOverlay">
        <div class="login-box">
            <h2>üîê Acceso Admin</h2>
            <div class="input-group">
                <label>Usuario</label>
                <input type="text" id="loginUsername" placeholder="usuario" onkeypress="if(event.key==='Enter') loginAdmin()">
            </div>
            <div class="input-group">
                <label>Contrase√±a</label>
                <input type="password" id="loginPassword" placeholder="contrase√±a" onkeypress="if(event.key==='Enter') loginAdmin()">
            </div>
            <button class="btn btn-primary" onclick="loginAdmin()">Iniciar Sesi√≥n</button>
            <div id="loginMessage"></div>
        </div>
    </div>

    <!-- CHANGE CREDENTIALS MODAL -->
    <div class="login-overlay" id="changeCredsOverlay">
        <div class="login-box">
            <h2>üîê Cambiar Credenciales</h2>
            <div class="input-group">
                <label>Nuevo Usuario</label>
                <input type="text" id="newUsername" placeholder="nuevo usuario">
            </div>
            <div class="input-group">
                <label>Nueva Contrase√±a</label>
                <input type="password" id="newPassword" placeholder="nueva contrase√±a">
            </div>
            <div class="input-group">
                <label>Confirmar Contrase√±a</label>
                <input type="password" id="confirmPassword" placeholder="confirmar contrase√±a">
            </div>
            <button class="btn btn-primary" onclick="updateCredentials()">Guardar Cambios</button>
            <button class="btn btn-secondary" style="margin-top: 8px;" onclick="closeChangeCredentialsModal()">Cancelar</button>
            <div id="credsMessage"></div>
        </div>
    </div>

    <script>
        // CONFIGURACI√ìN DE GITHUB (rellena esto en casa)
        const GITHUB_TOKEN = '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';
        const GITHUB_OWNER = 'perellades';
        const GITHUB_REPO = 'portal-videos';

        // Variables globales
        let data = JSON.parse(localStorage.getItem('portalData')) || {
            name: "Portal Educativo",
            children: []
        };

        let currentPath = [];
        let currentMode = 'admin';
        let isLoggedIn = false;

        // CREDENCIALES POR DEFECTO
        const DEFAULT_CREDENTIALS = {
            username: 'admin',
            password: '1234'
        };

        // FUNCIONES DE LOGIN
        function getStoredCredentials() {
            const stored = localStorage.getItem('adminCredentials');
            if (stored) {
                try {
                    return JSON.parse(stored);
                } catch (e) {
                    return DEFAULT_CREDENTIALS;
                }
            }
            return DEFAULT_CREDENTIALS;
        }

        function saveCredentials(username, password) {
            localStorage.setItem('adminCredentials', JSON.stringify({ username, password }));
        }

        function loginAdmin() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const credentials = getStoredCredentials();

            if (username === credentials.username && password === credentials.password) {
                isLoggedIn = true;
                document.getElementById('loginOverlay').classList.remove('active');
                document.getElementById('changeCredsBtn').style.display = 'block';
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
                showMessage('Bienvenido al Modo Admin', 'success');
            } else {
                const msgDiv = document.getElementById('loginMessage');
                msgDiv.innerHTML = '<div class="message error" style="margin-top: 16px;">Usuario o contrase√±a incorrectos</div>';
                setTimeout(() => msgDiv.innerHTML = '', 3000);
            }
        }

        function showChangeCredentialsModal() {
            document.getElementById('changeCredsOverlay').classList.add('active');
        }

        function closeChangeCredentialsModal() {
            document.getElementById('changeCredsOverlay').classList.remove('active');
            document.getElementById('newUsername').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            document.getElementById('credsMessage').innerHTML = '';
        }

        function updateCredentials() {
            const newUsername = document.getElementById('newUsername').value.trim();
            const newPassword = document.getElementById('newPassword').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();

            if (!newUsername || !newPassword) {
                const msgDiv = document.getElementById('credsMessage');
                msgDiv.innerHTML = '<div class="message error" style="margin-top: 16px;">Por favor completa todos los campos</div>';
                return;
            }

            if (newPassword !== confirmPassword) {
                const msgDiv = document.getElementById('credsMessage');
                msgDiv.innerHTML = '<div class="message error" style="margin-top: 16px;">Las contrase√±as no coinciden</div>';
                return;
            }

            saveCredentials(newUsername, newPassword);
            const msgDiv = document.getElementById('credsMessage');
            msgDiv.innerHTML = '<div class="message success" style="margin-top: 16px;">Credenciales actualizadas correctamente</div>';
            setTimeout(() => closeChangeCredentialsModal(), 2000);
        }

        // UTILIDADES
        function saveData() {
            localStorage.setItem('portalData', JSON.stringify(data));
        }

        function showMessage(text, type = 'success') {
            const container = document.getElementById('adminMessage');
            const msg = document.createElement('div');
            msg.className = `message ${type}`;
            msg.textContent = text;
            container.innerHTML = '';
            container.appendChild(msg);
            setTimeout(() => msg.remove(), 3000);
        }

        function switchMode(mode) {
            if (mode === 'admin' && !isLoggedIn) {
                document.getElementById('loginOverlay').classList.add('active');
                return;
            }

            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            document.getElementById('adminPanel').classList.remove('active');
            document.getElementById('portalView').classList.remove('active');

            if (mode === 'admin') {
                document.getElementById('adminPanel').classList.add('active');
                renderAdminTree();
                updateParentSelect();
            } else {
                document.getElementById('portalView').classList.add('active');
                currentPath = [];
                renderPortal();
            }
        }

        function findNode(id) {
            let found = null;
            
            function search(node) {
                if (node.id === id) {
                    found = node;
                    return;
                }
                if (node.children) {
                    for (let child of node.children) {
                        search(child);
                    }
                }
            }
            
            search(data);
            return found;
        }

        function generateId() {
            return 'item_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // FUNCIONES ADMIN
        function updateAdminForm() {
            const type = document.getElementById('elementType').value;
            document.getElementById('thumbnailGroup').style.display = type === 'video' ? 'none' : 'flex';
            document.getElementById('driveIdGroup').style.display = type === 'video' ? 'flex' : 'none';
            document.getElementById('videoTitleGroup').style.display = type === 'video' ? 'flex' : 'none';
        }

        function updateParentSelect() {
            const select = document.getElementById('parentSelect');
            const type = document.getElementById('elementType').value;
            select.innerHTML = '<option value="">Portal Principal</option>';

            function addOptions(node, level = 0) {
                if (level > 0 && (type === 'area' && level === 1 || type === 'video' && level === 2)) {
                    const option = document.createElement('option');
                    option.value = node.id;
                    option.textContent = '  '.repeat(level) + node.name;
                    select.appendChild(option);
                }
                if (node.children && level < 2) {
                    for (let child of node.children) {
                        addOptions(child, level + 1);
                    }
                }
            }

            addOptions(data);
        }

        function addElement() {
            const type = document.getElementById('elementType').value;
            const name = document.getElementById('elementName').value.trim();
            const parentId = document.getElementById('parentSelect').value;

            if (!name) {
                showMessage('Por favor ingresa un nombre', 'error');
                return;
            }

            const newElement = {
                id: generateId(),
                name: name,
                type: type
            };

            if (type === 'video') {
                const driveId = document.getElementById('driveId').value.trim();
                const videoTitle = document.getElementById('videoTitle').value.trim();
                if (!driveId) {
                    showMessage('Por favor ingresa el ID de Google Drive', 'error');
                    return;
                }
                if (!videoTitle) {
                    showMessage('Por favor ingresa el t√≠tulo del video', 'error');
                    return;
                }
                newElement.driveId = driveId;
                newElement.title = videoTitle;
                newElement.thumbnail = '‚ñ∂';
            } else {
                const thumbnail = document.getElementById('thumbnail').value.trim() || 'üìÅ';
                newElement.thumbnail = thumbnail;
                newElement.children = [];
            }

            if (parentId === '') {
                data.children.push(newElement);
            } else {
                const parent = findNode(parentId);
                if (parent) {
                    if (!parent.children) parent.children = [];
                    parent.children.push(newElement);
                }
            }

            saveData();
            renderAdminTree();
            updateParentSelect();
            clearAdminForm();
            showMessage(`${type.toUpperCase()} agregado correctamente`);
        }

        function deleteElement(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esto?')) {
                function remove(node) {
                    if (node.children) {
                        node.children = node.children.filter(child => {
                            if (child.id === id) return false;
                            return remove(child) !== false;
                        });
                    }
                    return true;
                }
                remove(data);
                saveData();
                renderAdminTree();
                updateParentSelect();
                showMessage('Elemento eliminado');
            }
        }

        function clearAdminForm() {
            document.getElementById('elementName').value = '';
            document.getElementById('thumbnail').value = '';
            document.getElementById('driveId').value = '';
            document.getElementById('videoTitle').value = '';
            document.getElementById('parentSelect').value = '';
            updateAdminForm();
        }

        function renderAdminTree(node = data, level = -1) {
            if (level === -1) {
                document.getElementById('adminTree').innerHTML = '';
            }

            if (level >= 0 && node.children) {
                for (let child of node.children) {
                    const item = document.createElement('div');
                    item.className = `tree-item level-${level}`;
                    
                    const label = document.createElement('span');
                    label.textContent = `${child.thumbnail || 'üìÅ'} ${child.name}`;
                    label.style.flex = '1';
                    
                    const actions = document.createElement('div');
                    actions.className = 'tree-item-actions';
                    actions.innerHTML = `<button onclick="deleteElement('${child.id}')">Eliminar</button>`;
                    
                    item.appendChild(label);
                    item.appendChild(actions);
                    
                    document.getElementById('adminTree').appendChild(item);
                    
                    if (child.children) {
                        renderAdminTree(child, level + 1);
                    }
                }
            } else if (level === -1 && node.children) {
                renderAdminTree(node, 0);
            }
        }

        function exportData() {
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'portal-datos.json';
            a.click();
            URL.revokeObjectURL(url);
            showMessage('Datos exportados');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    data = JSON.parse(e.target.result);
                    saveData();
                    renderAdminTree();
                    updateParentSelect();
                    showMessage('Datos importados correctamente');
                } catch (err) {
                    showMessage('Error al importar: ' + err.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        function saveToGitHub() {
            if (GITHUB_TOKEN === 'AQUI_PEGA_TU_TOKEN') {
                showMessage('Por favor configura tu token de GitHub en el c√≥digo', 'error');
                return;
            }

            const json = JSON.stringify(data, null, 2);
            const content = btoa(json); // Base64 encoding

            fetch(`https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/portal-datos.json`, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${GITHUB_TOKEN}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: 'Actualizar datos del portal',
                    content: content
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.content) {
                    showMessage('‚úÖ Datos guardados en GitHub correctamente');
                } else {
                    showMessage('Error: ' + (data.message || 'Error desconocido'), 'error');
                }
            })
            .catch(error => {
                showMessage('Error al guardar: ' + error.message, 'error');
            });
        }

        function resetData() {
            if (confirm('‚ö†Ô∏è ¬øEst√°s seguro? Esto eliminar√° TODOS los datos.')) {
                data = { name: "Portal Educativo", children: [] };
                saveData();
                renderAdminTree();
                updateParentSelect();
                showMessage('Todo eliminado');
            }
        }

        // FUNCIONES PORTAL
        function renderBreadcrumb() {
            const bc = document.getElementById('breadcrumb');
            bc.innerHTML = '<button onclick="portalGoHome()" style="color: var(--color-primary); background:none; border:none; cursor:pointer; text-decoration:underline;">üè† Inicio</button>';

            currentPath.forEach((item, index) => {
                bc.innerHTML += '<span> / </span>';
                if (index === currentPath.length - 1) {
                    bc.innerHTML += `<span>${item.name}</span>`;
                } else {
                    bc.innerHTML += `<button onclick="portalGoToLevel(${index})" style="color: var(--color-primary); background:none; border:none; cursor:pointer; text-decoration:underline;">${item.name}</button>`;
                }
            });
        }

        function renderPortal(nodeId = null) {
            let current = data;

            if (nodeId) {
                current = findNode(nodeId);
            } else {
                for (let item of currentPath) {
                    if (current.children) {
                        current = current.children.find(c => c.id === item.id);
                    }
                }
            }

            renderBreadcrumb();

            const content = document.getElementById('portalContent');
            let html = '<div class="grid">';

            if (current.children && current.children.length > 0) {
                current.children.forEach(child => {
                    let displayTitle = child.name;
                    let displaySubtitle = '';
                    
                    if (child.type === 'video') {
                        displayTitle = child.title || child.name;
                        displaySubtitle = child.name;
                    } else {
                        displaySubtitle = child.children ? `${child.children.length} elementos` : '';
                    }
                    
                    html += `
                        <div class="card" onclick="portalNavigate('${child.id}')">
                            <div class="card-thumbnail">${child.thumbnail || 'üìÅ'}</div>
                            <div class="card-content">
                                <div class="card-title">${displayTitle}</div>
                                ${displaySubtitle ? `<div class="card-subtitle">${displaySubtitle}</div>` : ''}
                            </div>
                        </div>
                    `;
                });
            }

            html += '</div>';
            content.innerHTML = html;
        }

        function portalNavigate(nodeId) {
            const node = findNode(nodeId);
            if (node.type === 'video') {
                playVideo(node.title || node.name, node.driveId);
            } else {
                currentPath.push(node);
                renderPortal();
            }
        }

        function portalGoHome() {
            currentPath = [];
            renderPortal();
        }

        function portalGoToLevel(index) {
            currentPath = currentPath.slice(0, index);
            renderPortal();
        }

        function playVideo(title, driveId) {
            // Abre el video a pantalla completa en una nueva pesta√±a
            const videoUrl = `https://drive.google.com/file/d/${driveId}/preview`;
            window.open(videoUrl, '_blank');
        }

        // Inicializar
        if (!isLoggedIn) {
            document.getElementById('adminPanel').classList.remove('active');
            document.getElementById('portalView').classList.remove('active');
            document.getElementById('loginOverlay').classList.add('active');
        } else {
            renderAdminTree();
            updateAdminForm();
            updateParentSelect();
        }
    </script>
</body>
</html>
